---
title: "Final Project 10"
author: "Odera Nwosu"
date: "2023-12-11"
output: html_document
---

```{r}
library(lubridate)
```

## Reading In & Formatting Data

::: {#formatting}
## Reading In & Formatting Data

```{r}
#data files
data <- read.csv(paste("./dataset/","aqny.csv", sep=''), header=TRUE)
```

```{r}
# data with timestamps
data$timestamp <- ymd(data$date)
start_date <- as.Date("2019-01-01")
end_date <-as.Date("2023-12-01")

time_period_string <- "2019/01/01 to 2023/12/01"
data <- data[, c("pm25", "o3", "timestamp")]
data <- data[data$timestamp > start_date | data$timestamp < end_date, ]
```
:::

::: {#raw_analysis}
## Raw Analysis of AQI Levels for Particulate Matter and Ozone

### I. Particulate Matter Data Summary

```{r}
hist(data$pm25, main = paste("Distribution of AQI for Particulate Matter (pm25) from", time_period_string), cex.main=.8, xlab = "Air Quality Index (AQI)", col="skyblue")
```

```{r}
boxplot(data$pm25, names = c("Particulate Matter (pm25)"), ylab="Aiq Quality Index", main = "Box Plot Comparison of pm25", col = c("skyblue"))


```

### II. Ozone AQI Data Summary

```{r}
hist(data$o3, main = "Histogram of Ozone AQI (o3) in the last 4 years", xlab = "Air Quality Index (AQI)", col="lightgreen")
abline(v =  100, col = "red", lwd = 2)

```

```{r}
cat("Days with Ozone AQIs unhealthy for sensitive groups (AQI above 100):", length(data[data$pm25 > 100,]))
```

### III. Statistical Summary of Particulate Matter AQI and Ozone AQI

```{r}
boxplot(data$pm25, data$o3, names = c("Particulate Matter (pm25)", "Ozone (o3)"), ylab="Aiq Quality Index", main = "Box Plot Comparison between pm25 and o3", col = c("skyblue", "lightgreen"))

summary(data$pm25)
summary(data$o3)

```

### IV. Statistical Summary of Difference Between Ozone & Particulate Matter
:::

::: {#test}
## Paired Difference T Procedure Analysis

### I. Analysis of AQI Difference between Particulate Matter (pm25) and Ozone (o3)

```{r}

complete_data <- na.omit(data)
complete_data$differences <- complete_data$pm25 - complete_data$o3
```

```{r}
summary(complete_data$differences)
```

```{r}
boxplot(complete_data$differences, names = c("Difference between AQI scores of Particulate matter and Ozone on a Given Day"), ylab="Aiq Quality Index Difference", main = "Box Plot of Difference between AQI scores of Particulate matter and Ozone on a Given Day", col = c("lightgreen")) 


```

```{r}
graph_dist_difference <- hist(complete_data$differences, main = "Distribution of Particulate Matter AQI (pm25) and Ozone (o3) AQI Difference in the last 4 years", xlab = "Air Quality Index (AQI)", col="skyblue", cex.main = 0.8)

```

### II. Anaylsis of Missing Data from AQI Difference between Particulate Matter (pm25) and Ozone (o3)

```{r}
all_days <- seq(start_date, end_date, by = "day")
missing_differences_days <- setdiff(all_days, complete_data$timestamp)
```

```{r}


cat("Total Days of missing values:", length(missing_differences_days), "\n" )
       
cat("Percent of missing days value for difference:", length(missing_differences_days)/length(all_days), "\n")

summary(as.Date(missing_differences_days))
```

```{r}
# Create a time plot with markers for missing times
plot(all_days, rep(1, length(all_days)), type = "n", xlab = "Time", ylab = "", main = "Time Plot with Missing Times")
# Mark missing times
points(missing_differences_days, rep(1, length(missing_differences_days)), cex = 0.7, pch = 4, col = "darkgreen")
```
:::

::: {#t-test}
## Hypothesis Testing for One Sample Mean

```{r}
n <- length(complete_data$pm25)
sig_level <- .05
```

### II. Hypothesis & Significance Level

```{r}
null_hypothesis_val <- 0
alpha_level <- .05
```

### III. Checking Assumptions

```{r}
cat("The assumption that we have over 30 points", (n > 30) )
```

### IV. Calculations

```{r}
x <- mean(complete_data$differences)
df <- n - 1
s <- sd(complete_data$differences)
```

```{r}
se <- s/sqrt(n)
cat("standard error:", se, "\n")

t_score <- (x - null_hypothesis_val)/se
cat("t-score:", t_score, "\n")
critical_val <- qt( 1 - alpha_level / 2, df)
me <- critical_val * se
cat("margin of error:", me, "\n")
```

```{r}

p_stat <- pt(t_score, df=df)
cat("p-stat:", p_stat, "\n")

p_value <- 1 - p_stat

cat("p_value:", p_value)
```

```{r}
lowerbound <- x - me
upperbound <- x + me
paste("bounds: [", lowerbound, ",", upperbound, "]")
```
:::
